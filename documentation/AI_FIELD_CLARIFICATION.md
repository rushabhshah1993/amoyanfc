# AI Fight Generation - Field Clarification

## Two Separate Description Fields

Your MongoDB schema has **TWO distinct description fields** that serve different purposes:

### 1. `userDescription` (User Input)
- **Source**: Provided by the user
- **Direction**: Input to the system
- **When used**: Only in "user-selected winner" mode
- **Purpose**: User's brief description of how the fight went
- **Optional**: Yes
- **Examples**:
  - Short: "Fighter 1 knocked out Fighter 2 with a roundhouse kick"
  - Detailed: "Fighter 1 dominated with striking. Fighter 2 tried grappling but Fighter 1's defense was solid. Final knockout came from a spinning back kick."

### 2. `genAIDescription` (AI Output)
- **Source**: Generated by OpenAI LLM
- **Direction**: Output from the system
- **When used**: ALWAYS (both simulation and user-selected modes)
- **Purpose**: Detailed, professional fight narrative
- **Optional**: No (always generated)
- **Length**: 3-4 paragraphs
- **Content**: Expanded, cinematic fight description with technical details

## Data Flow

### Mode 1: Simulate Fight (AI Chooses Winner)

```
User Input:
  - competitionId
  - fighter1Id
  - fighter2Id
  - (no userDescription)

AI Generates:
  - Analyzes fighters
  - Determines winner
  - Creates narrative
  
Output to MongoDB:
  {
    winner: ObjectId("..."),
    genAIDescription: "Full AI-generated narrative...",
    userDescription: undefined,  // Not used in this mode
    isSimulated: true
  }
```

### Mode 2: User Selects Winner

```
User Input:
  - competitionId
  - fighter1Id
  - fighter2Id
  - winnerId: "676d6ecceb38b2b97c6da945"
  - userDescription: "Fighter 1 dominated with kicks"  (optional)

AI Generates:
  - Takes user's description (if provided)
  - Expands it into detailed narrative
  - Creates consistent statistics
  
Output to MongoDB:
  {
    winner: ObjectId("676d6ecceb38b2b97c6da945"),
    genAIDescription: "Expanded AI narrative based on user input...",
    userDescription: "Fighter 1 dominated with kicks",  // Preserved
    isSimulated: false
  }
```

## Key Differences

| Aspect | userDescription | genAIDescription |
|--------|----------------|------------------|
| **Author** | Human user | AI (OpenAI) |
| **Length** | 1 sentence to 1 paragraph | 3-4 paragraphs |
| **Detail** | Brief summary | Detailed narrative |
| **Style** | Casual, brief | Cinematic, professional |
| **Required** | No | Yes |
| **When** | User-selected mode only | Always |
| **Purpose** | User's input/preference | Final fight narrative |

## MongoDB Schema

```javascript
const fightSchema = new Schema({
    fighter1: { type: Schema.Types.ObjectId, ref: 'Fighter', required: true },
    fighter2: { type: Schema.Types.ObjectId, ref: 'Fighter', required: true },
    winner: { type: Schema.Types.ObjectId, ref: 'Fighter' },
    fightIdentifier: String,
    date: Date,
    
    // USER INPUT - What the user typed (optional)
    userDescription: String,
    
    // AI OUTPUT - What the LLM generated (always present)
    genAIDescription: String,
    
    isSimulated: { type: Boolean, default: false },
    fighterStats: [fightStatsSchema],
    fightStatus: { type: String, enum: ['pending', 'completed'], default: 'pending' }
});
```

## AI Prompt Handling

### What AI Receives (User-Selected Mode with Description):

```
PREDETERMINED WINNER: Sayali Raut (ID: 676d6ecceb38b2b97c6da945)

USER PROVIDED THIS DESCRIPTION:
"Sayali dominated with superior striking and landed a knockout kick"

YOUR TASK:
Using this as a foundation, expand it into a detailed 3-4 paragraph narrative that:
- Incorporates all the user's key points
- Adds technical details and atmosphere
- Makes the fight come alive
- Ensures Sayali Raut wins by knockout
```

### What AI Must Output:

```json
{
  "genAIDescription": "The fight opened with both fighters...",  // ✅ AI's output
  "winnerId": "676d6ecceb38b2b97c6da945",
  "fighterStats": [...]
}
```

### What AI Must NOT Do:

```json
{
  "userDescription": "...",  // ❌ WRONG - This is for user input, not AI output
  "description": "...",      // ❌ WRONG - Wrong field name
  "narrative": "...",        // ❌ WRONG - Wrong field name
  "fightDescription": "..."  // ❌ WRONG - Wrong field name
}
```

## Service Layer Handling

```javascript
// In resolver
const { winnerId, userDescription } = input;

// Pass to service
const result = await generateFightResult(
    fighter1,
    fighter2,
    false,  // isSimulated
    winnerId,
    userDescription  // User's brief description (or null)
);

// Result from AI
{
    genAIDescription: "AI's expanded narrative...",
    winnerId: "676d6ecceb38b2b97c6da945",
    fighterStats: [...]
}

// Update fight in MongoDB
fight.winner = result.winnerId;
fight.genAIDescription = result.genAIDescription;  // AI's output
fight.userDescription = userDescription;            // User's input (if provided)
fight.isSimulated = false;
```

## Frontend Display

### Option 1: Show Both (Recommended)
```jsx
{fight.userDescription && (
  <div className="user-description">
    <h4>Your Description:</h4>
    <p>{fight.userDescription}</p>
  </div>
)}

<div className="ai-description">
  <h4>Full Fight Description:</h4>
  <p>{fight.genAIDescription}</p>
</div>
```

### Option 2: Show Only AI Description
```jsx
<div className="fight-description">
  <h4>Fight Description:</h4>
  <p>{fight.genAIDescription}</p>
  {fight.userDescription && (
    <small className="user-note">Based on your input</small>
  )}
</div>
```

## Examples

### Example 1: Simulation Mode

```javascript
// User action: Click "Simulate Fight"

// MongoDB Result:
{
  winner: ObjectId("fighter1_id"),
  genAIDescription: "The fight began with both fighters...",  // 3-4 paragraphs
  userDescription: null,  // No user input
  isSimulated: true
}
```

### Example 2: User-Selected (No Description)

```javascript
// User action: Select winner, no description provided

// MongoDB Result:
{
  winner: ObjectId("fighter1_id"),
  genAIDescription: "Fighter 1 secured victory in this...",  // 3-4 paragraphs
  userDescription: null,  // User didn't provide one
  isSimulated: false
}
```

### Example 3: User-Selected (With Description)

```javascript
// User action: Select winner, provide description
// User types: "Epic battle. Fighter 1 won with a head kick."

// MongoDB Result:
{
  winner: ObjectId("fighter1_id"),
  genAIDescription: "The fight was an epic display of martial arts. Both fighters...",  // AI expanded it
  userDescription: "Epic battle. Fighter 1 won with a head kick.",  // User's original
  isSimulated: false
}
```

## Summary

✅ **userDescription**:
- User's brief input (optional)
- Stored as-is
- Used as context for AI

✅ **genAIDescription**:
- AI's full narrative (always generated)
- 3-4 detailed paragraphs
- Final fight description

❌ **Common Mistake**:
- Thinking AI should write to `userDescription`
- These are separate fields with different purposes!

## Validation in Code

```javascript
// In service validation
if (!result.genAIDescription || !result.winnerId || !result.fighterStats) {
    throw new Error('Invalid AI response structure');
}

// genAIDescription is REQUIRED from AI
// userDescription is OPTIONAL from user
```

**Remember**: The AI always outputs to `genAIDescription`, never to `userDescription`!

